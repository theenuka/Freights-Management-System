# docker-compose.yml - Generated by Ansible
# Freights Management System - {{ env | default('dev') }} environment

services:
  mongo:
    image: mongo:6
    container_name: fms-mongo
    restart: unless-stopped
    volumes:
      - mongo_data:/data/db
    networks:
      - fms-network

  backend:
    image: {{ images.backend }}:{{ deploy_tag }}
    container_name: fms-backend
    restart: unless-stopped
    environment:
      - PORT={{ backend_port }}
      - DB={{ vault_db_string }}
      - PASS={{ vault_backend_pass }}
      - JWT_SEC={{ vault_backend_jwt }}
    depends_on:
      - mongo
    ports:
      - "{{ ports.backend }}:8000"
    networks:
      - fms-network

  frontend:
    image: {{ images.frontend }}:{{ deploy_tag }}
    container_name: fms-frontend
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "{{ ports.frontend }}:80"
    networks:
      - fms-network

  admin:
    image: {{ images.admin }}:{{ deploy_tag }}
    container_name: fms-admin
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "{{ ports.admin }}:80"
    networks:
      - fms-network

  background:
    image: {{ images.background }}:{{ deploy_tag }}
    container_name: fms-background
    restart: unless-stopped
    environment:
      - DB={{ vault_db_string }}
{% if vault_email_user is defined and vault_email_user %}
      - EMAIL_USER={{ vault_email_user }}
{% endif %}
{% if vault_email_pass is defined and vault_email_pass %}
      - EMAIL_PASS={{ vault_email_pass }}
{% endif %}
    depends_on:
      - mongo
    networks:
      - fms-network

networks:
  fms-network:
    driver: bridge
    name: freights-net

volumes:
  mongo_data:
    name: fms-mongo-data
